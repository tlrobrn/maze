"use strict";Date.now=function(){return Date.now||function(){return+new Date}}();var game={width:640,height:480,tile_width:32,tile_height:32,start:function(){Crafty.init(this.width,this.height),Crafty.scene("Loading")}};!function(){Crafty.c("Cell",{init:function(){this.requires("2D, Canvas, Color"),this.attr({w:game.tile_width,h:game.tile_height})},at:function(a,b){return void 0===a&&void 0===b?{x:this.x/this.w,y:this.y/this.h}:(this.attr({x:a*this.w,y:b*this.h}),this)}}),Crafty.c("Open",{init:function(){this.requires("Cell").color("#FFFFFF")}}),Crafty.c("Wall",{init:function(){this.requires("Cell, Solid").color("#000000")}}),Crafty.c("Start",{init:function(){this.requires("Cell").color("#00FF00")}}),Crafty.c("End",{init:function(){this.requires("Cell").color("#FF0000")}}),Crafty.c("Player",{init:function(){this.requires("Cell, Fourway, Collision").attr({w:this.w/2,h:this.h/2}).color("#FFFF00").fourway(2).stopOnSolids().onHit("End",this.victory)},stopOnSolids:function(){return this.onHit("Solid",this.stopMovement),this},stopMovement:function(){this._speed=0,this._movement&&(this.x-=this._movement.x,this.y-=this._movement.y)},victory:function(){Crafty.scene("Victory")}})}(),function(){var a,b,c;a=function(a){for(var b,c,d=a.length;d--;)b=Math.floor(Math.random()*d+1),c=a[d],a[d]=a[b],a[b]=c},b={_sets:[],make_set:function(a){void 0===a&&(a=1);for(var b=a;b--;)this._sets.push(-1);return this},find:function(a){return this._sets[a]<0?a:(this._sets[a]=this.find(this._sets[a]),this._sets[a])},union:function(a,b){return a=this.find(a),b=this.find(b),a!==b&&(this._sets[a]<this._sets[b]?(this._sets[a]+=this._sets[b],this._sets[b]=a):(this._sets[b]+=this._sets[a],this._sets[a]=b)),this},reset:function(){return this._sets.length=0,this}},c={_walls:[],_width:0,_height:0,_start:0,_end:0,create:function(c,d){var e,f,g,h=[],i=[];for(this._width=c,this._height=d,this._walls.length=c*d,b.reset().make_set(this._walls.length),f=this._height;f--;)for(e=this._width;e--;)g=e+f*c,1&e||1&f?this._walls[g]=!0:(this._walls[g]=!1,h.push(g),i.push(g));for(a(h),a(i),g=h.length;g--;)this._trywall(h[g],!0),this._trywall(i[g],!1);this.solve()},_trywall:function(a,c){var d;if(c){if(1===this._width||a%this._width>=this._width-2)return;d=1}else{if(1===this._height||Math.floor(a/this._width)>=this._height-2)return;d=this._width}b.find(a)!==b.find(a+2*d)&&(this._walls[a+d]=!1,b.union(a,a+d),b.union(a,a+2*d))},solve:function(){var a=0,b=0,d=0,e=[];e.length=this._walls.length,function f(g,h,i){var j,k;j=g+h*c._width,e[j]=!0,g>0&&(k=g-1+h*c._width,e[k]||c._walls[k]||f(g-1,h,i+1)),g<c._width-1&&(k=g+1+h*c._width,e[k]||c._walls[k]||f(g+1,h,i+1)),h>0&&(k=g+(h-1)*c._width,e[k]||c._walls[k]||f(g,h-1,i+1)),h<c._height-1&&(k=g+(h+1)*c._width,e[k]||c._walls[k]||f(g,h+1,i+1)),(i>a||i===a&&h>d||i===a&&h===d&&b>g)&&(a=i,c._end=j,b=g,d=h),e[j]=!1}(0,0,0)}},Crafty.scene("Maze",function(){Crafty.audio.play("theme",-1),c.create(game.width/game.tile_width,game.height/game.tile_height);for(var a,b,d=c._walls.length;--d;)a=d%c._width,b=Math.floor(d/c._width),d===c._end?Crafty.e("End").at(a,b):Crafty.e(c._walls[d]?"Wall":"Open").at(a,b);for(d=c._height;d--;)Crafty.e("Cell, Solid").at(-1,d),Crafty.e("Cell, Solid").at(c._width,d);for(d=c._width;d--;)Crafty.e("Cell, Solid").at(d,-1),Crafty.e("Cell, Solid").at(d,c._height);Crafty.e("Start").at(0,0),Crafty.e("Player").at(0,0)});var d=function(){Crafty.scene("Maze")};Crafty.scene("Victory",function(){Crafty.background("#00FF00"),Crafty.bind("KeyDown",d)},function(){Crafty.unbind("KeyDown",d)}),Crafty.scene("Loading",function(){var a=Crafty.e("2D, DOM, Text").text("Loading...").attr({x:0,y:game.height/2,w:game.width}).css({color:"#FFFFFF"});Crafty.audio.canPlay(),Crafty.load(["assets/audio/Lost.mp3","assets/audio/Lost.ogg"],function(){Crafty.audio.add({theme:["assets/audio/Lost.mp3","assets/audio/Lost.ogg"]}),Crafty.scene("Maze")},function(b){a.text("Loading... "+b.percent+"%")},function(a){console.log(a)})})}();